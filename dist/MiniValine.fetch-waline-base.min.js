(self.webpackChunkMiniValine=self.webpackChunkMiniValine||[]).push([[864],{306:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchBase=function(e){var t="".concat(e.config.serverURLs,"/comment");e.fetchCount=function(e){(0,i.default)({url:t,type:"GET",data:{type:"count",url:e.config.pathname},success:function(t){e.el.querySelector(".count").innerHTML=t},error:e.error})},e.fetchTotalPages=function(e,n){(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:1},success:function(e){window.MV.WalinePageData=e,n(e.totalPages)},error:e.error})},e.fetchParentList=function(e,n,r){if(1==n){var s=new a.default;window.MV.WalinePageList=s.beanList(window.MV.WalinePageData.data),r(window.MV.WalinePageList)}else(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:n},success:function(e){window.MV.WalinePageData=e;var t=new a.default;window.MV.WalinePageList=t.beanList(e.data),r(window.MV.WalinePageList)},error:e.error})},e.fetchNextList=function(e,t,n){for(var i=[],a=window.MV.WalinePageList,r=0;r<a.length;r++)if(a[r].children)for(var s=0;s<a[r].children.length;s++)t==a[r].children[s].rid&&i.push(a[r].children[s]);n(i)},e.fetchNextCount=function(e,t,n){for(var i=[],a=window.MV.WalinePageList,r=0;r<a.length;r++)if(a[r].children)for(var s=0;s<a[r].children.length;s++)t==a[r].children[s].rid&&i.push(a[r].children[s]);i.length>0&&n(1)},e.postComment=function(e,n){var r=new a.default;for(var s in e.C)if(e.C.hasOwnProperty(s)){var o=e.C[s];"at"===s&&(o=o.substr(1)),r.set(s,o)}r.set("createdAt",new Date);var c=Object.create(null);if((c={comment:r.comment,link:r.link,mail:r.mail,nick:r.nick,ua:r.ua,url:r.url,at:r.at}).at){var l=JSON.parse(window.atob(document.querySelector("#comment-"+r.rid+" .comment-item").textContent));l.pid?c.rid=l.pid:c.rid=l.id,c.pid=l.id}console.log(c),(0,i.default)({url:t,type:"POST",data:c,success:function(t){t.errno?e.error(t.errno,t):(new a.default).create(t.data);n(r)},error:function(t,i){e.error(t,i),n(r)}})}};var i=r(n(4460)),a=r(n(6818));function r(e){return e&&e.__esModule?e:{default:e}}},6818:e=>{"use strict";e.exports=function e(){this.set=function(e,t){this[e]=t},this.get=function(e){return this[e]},this.create=function(t){this.set("nick",t.nick),this.set("mailMd5",t.mail),this.set("link",t.link),this.set("createdAt",new Date(t.insertedAt)),this.set("id",t.objectId),this.set("rid",t.pid),this.set("pid",t.rid),this.set("browser",t.browser),this.set("os",t.os),this.set("comment",t.comment);var n=new e;this.set("children",n.beanList(t.children))},this.beanList=function(t){var n=[];if(t&&t.length)for(var i=0;i<t.length;i++){var a=new e;a.create(t[i]),n.push(a)}return n}}}}]);