(self.webpackChunkMiniValine=self.webpackChunkMiniValine||[]).push([[864],{306:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchBase=function(e){var t="".concat(e.config.serverURLs,"/comment");e.fetchCount=function(e){(0,i.default)({url:t,type:"GET",data:{type:"count",url:e.config.pathname},success:function(t){e.el.querySelector(".count").innerHTML=t}})},e.fetchTotalPages=function(e,n){(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:1},success:function(e){window.MV.WalinePageData=e,n(e.totalPages)}})},e.fetchParentList=function(e,n,s){if(1==n){var r=new a.default;window.MV.WalinePageList=r.beanList(window.MV.WalinePageData.data),s(window.MV.WalinePageList)}else(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:n},success:function(e){window.MV.WalinePageData=e;var t=new a.default;window.MV.WalinePageList=t.beanList(e.data),s(window.MV.WalinePageList)}})},e.fetchNextList=function(e,t,n){for(var i=[],a=window.MV.WalinePageList,s=0;s<a.length;s++)if(a[s].children)for(var r=0;r<a[s].children.length;r++)t==a[s].children[r].rid&&i.push(a[s].children[r]);n(i)},e.fetchNextCount=function(e,t,n){for(var i=[],a=window.MV.WalinePageList,s=0;s<a.length;s++)if(a[s].children)for(var r=0;r<a[s].children.length;r++)t==a[s].children[r].rid&&i.push(a[s].children[r]);i.length>0&&n(1)},e.postComment=function(e,n){var s=new a.default;for(var r in e.C)if(e.C.hasOwnProperty(r)){var c=e.C[r];"at"===r&&(c=c.substr(1)),s.set(r,c)}s.set("createdAt",new Date);var o=Object.create(null);if((o={comment:s.comment,link:s.link,mail:s.mail,nick:s.nick,ua:s.ua,url:s.url,at:s.at}).at){var l=JSON.parse(window.atob(document.querySelector("#comment-"+s.rid+" .comment-item").textContent));l.pid?o.rid=l.pid:o.rid=l.id,o.pid=l.id}(0,i.default)({url:t,type:"POST",data:o,success:function(e){var t=new a.default;t.create(e.data),n(t)}})}};var i=s(n(4460)),a=s(n(6818));function s(e){return e&&e.__esModule?e:{default:e}}},6818:e=>{"use strict";e.exports=function e(){this.set=function(e,t){this[e]=t},this.get=function(e){return this[e]},this.create=function(t){this.set("nick",t.nick),this.set("mailMd5",t.mail),this.set("link",t.link),this.set("createdAt",new Date(t.createdAt)),this.set("id",t.objectId),this.set("rid",t.pid),this.set("pid",t.rid),this.set("browser",t.browser),this.set("os",t.os),this.set("comment",t.comment);var n=new e;this.set("children",n.beanList(t.children))},this.beanList=function(t){var n=[];if(t&&t.length)for(var i=0;i<t.length;i++){var a=new e;a.create(t[i]),n.push(a)}return n}}}}]);