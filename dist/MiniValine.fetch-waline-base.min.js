(self.webpackChunkMiniValine=self.webpackChunkMiniValine||[]).push([[864],{306:function(e,t,n){"use strict";var i=n(8157);Object.defineProperty(t,"__esModule",{value:!0}),t.FetchBase=function(e){var t="".concat(e.conf.serverURL,"/comment");e.fetchCount=function(e){(0,r["default"])({url:t,type:"GET",data:{type:"count",url:e.conf.path},success:function(t){e.el.querySelector(".count").innerHTML=t},error:e.error})},e.fetchTotalPages=function(e,n){(0,r["default"])({url:t,type:"GET",data:{path:e.conf.path,pageSize:e.conf.pageSize,page:1},success:function(e){window.MV.WalinePageData=e,n(e.totalPages)},error:e.error})},e.fetchParentList=function(e,n,i){if(1==n){var o=new a["default"];window.MV.WalinePageList=o.beanList(window.MV.WalinePageData.data),i(window.MV.WalinePageList)}else(0,r["default"])({url:t,type:"GET",data:{path:e.conf.path,pageSize:e.conf.pageSize,page:n},success:function(e){window.MV.WalinePageData=e;var t=new a["default"];window.MV.WalinePageList=t.beanList(e.data),i(window.MV.WalinePageList)},error:e.error})},e.fetchNextList=function(e,t,n){for(var i=[],r=window.MV.WalinePageList,a=0;a<r.length;a++)if(r[a].children)for(var o=0;o<r[a].children.length;o++)t==r[a].children[o].rid&&i.push(r[a].children[o]);n(i)},e.fetchNextCount=function(e,t,n){for(var i=[],r=window.MV.WalinePageList,a=0;a<r.length;a++)if(r[a].children)for(var o=0;o<r[a].children.length;o++)t==r[a].children[o].rid&&i.push(r[a].children[o]);i.length>0&&n(1)},e.postComment=function(e,n){var i=new a["default"];for(var o in e.C)if(e.C.hasOwnProperty(o)){var s=e.C[o];"at"===o&&(s=s.substr(1)),i.set(o,s)}var c=Object.create(null);if((c={comment:i.comment,link:i.link,mail:i.mail,nick:i.nick,ua:i.ua,url:i.url,at:i.at}).at){var l=JSON.parse(window.atob(document.querySelector("#comment-"+i.rid+" .comment-item").textContent));l.pid?c.rid=l.pid:c.rid=l.id,c.pid=l.id}console.log(c),(0,r["default"])({url:t,type:"POST",data:c,success:function(t){if(t.errno)e.error(t.errno,t);else if(t.data.comment){var i=new a["default"];i.create(t.data),n(i)}else e.error(12138,t)},error:function(t,n){e.error(t,n)}})}};var r=i(n(4460)),a=i(n(6818))},6818:function(e){"use strict";e.exports=function t(){this.set=function(e,t){this[e]=t},this.get=function(e){return this[e]},this.create=function(e){this.set("nick",e.nick),this.set("mailMd5",e.mail),this.set("link",e.link),this.set("createdAt",new Date(e.insertedAt)),this.set("id",e.objectId),this.set("rid",e.pid),this.set("pid",e.rid),this.set("browser",e.browser),this.set("os",e.os),this.set("comment",e.comment);var n=new t;this.set("children",n.beanList(e.children))},this.beanList=function(e){var n=[];if(e&&e.length)for(var i=0;i<e.length;i++){var r=new t;r.create(e[i]),n.push(r)}return n}}}}]);