(self.webpackChunkMiniValine=self.webpackChunkMiniValine||[]).push([[864],{306:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchBase=function(e){var t="".concat(e.config.serverURLs,"/comment");e.fetchCount=function(e){(0,i.default)({url:t,type:"GET",data:{type:"count",url:e.config.pathname},success:function(t){e.el.querySelector(".count").innerHTML=t},error:e.error})},e.fetchTotalPages=function(e,n){(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:1},success:function(e){window.MV.WalinePageData=e,n(e.totalPages)},error:e.error})},e.fetchParentList=function(e,n,a){if(1==n){var s=new r.default;window.MV.WalinePageList=s.beanList(window.MV.WalinePageData.data),a(window.MV.WalinePageList)}else(0,i.default)({url:t,type:"GET",data:{path:e.config.pathname,pageSize:e.pageSize,page:n},success:function(e){window.MV.WalinePageData=e;var t=new r.default;window.MV.WalinePageList=t.beanList(e.data),a(window.MV.WalinePageList)},error:e.error})},e.fetchNextList=function(e,t,n){for(var i=[],r=window.MV.WalinePageList,a=0;a<r.length;a++)if(r[a].children)for(var s=0;s<r[a].children.length;s++)t==r[a].children[s].rid&&i.push(r[a].children[s]);n(i)},e.fetchNextCount=function(e,t,n){for(var i=[],r=window.MV.WalinePageList,a=0;a<r.length;a++)if(r[a].children)for(var s=0;s<r[a].children.length;s++)t==r[a].children[s].rid&&i.push(r[a].children[s]);i.length>0&&n(1)},e.postComment=function(e,n){var a=new r.default;for(var s in e.C)if(e.C.hasOwnProperty(s)){var o=e.C[s];"at"===s&&(o=o.substr(1)),a.set(s,o)}var c=Object.create(null);if((c={comment:a.comment,link:a.link,mail:a.mail,nick:a.nick,ua:a.ua,url:a.url,at:a.at}).at){var l=JSON.parse(window.atob(document.querySelector("#comment-"+a.rid+" .comment-item").textContent));l.pid?c.rid=l.pid:c.rid=l.id,c.pid=l.id}console.log(c),(0,i.default)({url:t,type:"POST",data:c,success:function(t){if(t.errno)e.error(t.errno,t);else if(t.comment){var i=new r.default;i.create(t.data),n(i)}else e.error(12138,t)},error:function(t,n){e.error(t,n)}})}};var i=a(n(4460)),r=a(n(6818));function a(e){return e&&e.__esModule?e:{default:e}}},6818:e=>{"use strict";e.exports=function e(){this.set=function(e,t){this[e]=t},this.get=function(e){return this[e]},this.create=function(t){this.set("nick",t.nick),this.set("mailMd5",t.mail),this.set("link",t.link),this.set("createdAt",new Date(t.insertedAt)),this.set("id",t.objectId),this.set("rid",t.pid),this.set("pid",t.rid),this.set("browser",t.browser),this.set("os",t.os),this.set("comment",t.comment);var n=new e;this.set("children",n.beanList(t.children))},this.beanList=function(t){var n=[];if(t&&t.length)for(var i=0;i<t.length;i++){var r=new e;r.create(t[i]),n.push(r)}return n}}}}]);