(window.webpackJsonpMiniValine=window.webpackJsonpMiniValine||[]).push([[7],{44:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FetchBase=function(e){e.setAV=function(e){var n,t="https://";if(!e.config.serverURLs)switch(e.config.appId.slice(-9)){case"-9Nh9j0Va":t+="tab.leancloud.cn";break;case"-MdYXbMMI":t+="console.leancloud.app";break;default:t+="avoscloud.com"}n=e.config.serverURLs||t;try{AV.init({appId:e.config.appId,appKey:e.config.appKey,serverURLs:n})}catch(e){}e.v=AV},e.fetchCount=function(e){var n=new e.v.Query("Comment");n.equalTo("url",e.C.url);var t=new e.v.Query("Comment");t.equalTo("url","".concat(e.C.url,"/"));var o=AV.Query.or(n,t);o.notEqualTo("isSpam",!0),o.count().then((function(n){e.el.querySelector(".count").innerHTML=n})).catch((function(n){console.log(n),e.el.querySelector(".count").innerHTML=0}))},e.fetchTotalPages=function(e,n){e.v.Query.doCloudQuery("select count(*) from Comment where (rid='' or rid is not exists) and (url='".concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(t){n(Math.ceil(t.count/e.pageSize))})).catch((function(e){console.log(e)}))},e.fetchParentList=function(e,n,t){e.v.Query.doCloudQuery("select nick, comment, link, rid, isSpam, mailMd5, ua ".concat(e.config.region?",log":""," from Comment where (rid='' or rid is not exists) and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt limit ").concat((n-1)*e.pageSize,",").concat(e.pageSize)).then((function(e){e=e&&e.results||[],t(e)})).catch((function(n){e.loading.hide(e.parentCount)}))},e.fetchNextList=function(e,n,t){e.v.Query.doCloudQuery("select nick, comment, link, rid, isSpam, mailMd5, ua ".concat(e.config.region?",log":""," from Comment where rid='").concat(n,"' and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(e){e=e&&e.results||[],t(e)})).catch((function(n){e.loading.hide(e.parentCount)}))},e.fetchNextCount=function(e,n,t){e.v.Query.doCloudQuery("select count(*) from Comment where rid='".concat(n,"' and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(e){var n=e.count;t(n)})).catch((function(e){console.log(e)}))},e.postComment=function(e,n){var t,o=new(e.v.Object.extend("Comment"));for(var c in e.C)if(e.C.hasOwnProperty(c)){if("at"===c)continue;var r=e.C[c];o.set(c,r)}o.setACL(((t=new e.v.ACL).setWriteAccess("role:"+e.role,!0),t.setPublicReadAccess(!0),t.setPublicWriteAccess(!1),t)),o.save({log:window.MV}).then((function(e){n(e)})).catch((function(n){e.submitting.hide()}))}}}}]);