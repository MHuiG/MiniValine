(self.webpackChunkMiniValine=self.webpackChunkMiniValine||[]).push([[401],{4593:function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FetchBase=function(e){e.setAV=function(e){var n="-MdYXbMMI"!==e.conf.appId.slice(-9)?e.conf.serverURL:"https://".concat(e.conf.appId.slice(0,8).toLowerCase(),".api.lncldglobal.com");if(n){try{AV.init({appId:e.conf.appId,appKey:e.conf.appKey,apiServer:n})}catch(t){}e.v=AV}else fetch("https://app-router.leancloud.cn/2/route?appId="+e.conf.appId).then((function(e){return e.json()})).then((function(o){var c=o.api_server;n="https://"+c;try{AV.init({appId:e.conf.appId,appKey:e.conf.appKey,apiServer:n})}catch(t){}e.v=AV}))},e.fetchCount=function(e){var n=new e.v.Query("Comment");n.equalTo("url",e.C.url);var t=new e.v.Query("Comment");t.equalTo("url","".concat(e.C.url,"/"));var o=AV.Query.or(n,t);o.notEqualTo("isSpam",!0),o.count().then((function(n){e.el.querySelector(".count").innerHTML=n}))["catch"]((function(n){console.error(n),e.el.querySelector(".count").innerHTML=0}))},e.fetchTotalPages=function(e,n){e.v.Query.doCloudQuery("select count(*) from Comment where (rid='' or rid is not exists) and (url='".concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(t){n(Math.ceil(t.count/e.conf.pageSize))}))["catch"]((function(e){console.error(e)}))},e.fetchParentList=function(e,n,t){e.v.Query.doCloudQuery("select nick, comment, link, rid, isSpam, mailMd5, ua ".concat(e.conf.region?",log":""," from Comment where (rid='' or rid is not exists) and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt limit ").concat((n-1)*e.conf.pageSize,",").concat(e.conf.pageSize)).then((function(e){e=e&&e.results||[],t(e)}))["catch"]((function(n){e.loading.hide(e.parentCount)}))},e.fetchNextList=function(e,n,t){e.v.Query.doCloudQuery("select nick, comment, link, rid, isSpam, mailMd5, ua ".concat(e.conf.region?",log":""," from Comment where rid='").concat(n,"' and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(e){e=e&&e.results||[],t(e)}))["catch"]((function(n){e.loading.hide(e.parentCount)}))},e.fetchNextCount=function(e,n,t){e.v.Query.doCloudQuery("select count(*) from Comment where rid='".concat(n,"' and (url='").concat(e.C.url,"' or url='","".concat(e.C.url,"/"),"') order by -createdAt")).then((function(e){var n=e.count;t(n)}))["catch"]((function(e){console.error(e)}))},e.postComment=function(e,n){var t=new(e.v.Object.extend("Comment"));for(var o in e.C)if(e.C.hasOwnProperty(o)){if("at"===o)continue;var c=e.C[o];t.set(o,c)}var r;t.setACL(((r=new e.v.ACL).setWriteAccess("role:"+e.conf.role,!0),r.setPublicReadAccess(!0),r.setPublicWriteAccess(!1),r)),t.save({log:window.MV}).then((function(e){n(e)}))["catch"]((function(n){e.submitting.hide()}))}}}}]);