var e,t;e=self,t=function(){return function(){"use strict";var e,t,n={8157:function(e){e.exports=function(e){return e&&e.__esModule?e:{"default":e}},e.exports["default"]=e.exports,e.exports.__esModule=!0},196:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.C=t.PS=t.MaxNL=t.DEHash=t.i18nUrl=t.pf=t.EUrl=t.avatarD=t.avatarUrl=t.MVUrl=t.VERSION=void 0;var n="5.1.7";t.VERSION=n;var o="https://cdn.jsdelivr.net/npm/minivaline@5.1.7";t.MVUrl=o,t.avatarUrl="https://secure.gravatar.com/avatar",t.avatarD="robohash";var r=[o+"/imgs/alus",o+"/imgs/qq",o+"/imgs/Bilibilis",o+"/imgs/tieba",o+"/imgs/twemoji",o+"/imgs/weibo",o+"/imgs/funny"];t.EUrl=r,t.pf="https://cdn.polyfill.io/v3/polyfill.min.js?features=es6",t.i18nUrl="https://cdn.jsdelivr.net/npm/minivaline@5.1.7/i18n/",t.DEHash="9e63c80900d106cbbec5a9f4ea433a3e",t.MaxNL=6,t.PS=6;var a={ip:"",comment:"",rid:"",at:"",nick:"",mail:"",mailMd5:"",link:"",ua:navigator.userAgent,url:location.pathname};t.C=a},6614:function(e,t,n){var o=n(8157),r=o(n(2434)),a=o(n(7375)),i=function(e){var t=this;try{if(t.conf=e,!document.querySelectorAll(t.conf.el)[0])return;a["default"].Config(t),a["default"].initStyle(t),a["default"].ActivateCode(t),a["default"].script(t),a["default"].i18n(t),a["default"].initLibs(t)}catch(n){console.error(n)}};i.prototype.initCheck=function(){var e=this;try{var t=setInterval((function(){e.i18n&&(clearInterval(t),"lc"==e.conf.backend?(n.e(401).then(n.bind(n,4593)).then((function(t){(0,t.FetchBase)(e)})),e.conf.cloudflag&&n.e(220).then(n.bind(n,5365)).then((function(t){(0,t.FetchCloudFlag)(e)}))):"waline"==e.conf.backend&&n.e(864).then(n.bind(n,306)).then((function(t){(0,t.FetchBase)(e)})),"DesertsP"===e.conf.mode?(n.e(940).then(n.bind(n,1268)).then((function(t){var n=t.getEle;e.ele=n(e),e.Start()})),n.e(840).then(n.bind(n,8535)).then((function(t){var n=t.Vcard;e.Vcard=n(e)}))):"xCss"===e.conf.mode&&(e.conf.enableUA&&"waline"!=e.conf.backend&&n.e(999).then(n.bind(n,3006)).then((function(e){(0,e.init)()})),n.e(290).then(n.bind(n,8223)).then((function(t){var n=t.getEle;e.ele=n(e),e.Start()}))),e.conf.barrager&&n.e(843).then(n.bind(n,2241)).then((function(t){var n=t.Vbarrager;e.Vbarrager=n(e)})))}),5)}catch(o){console.error(o)}},i.prototype.Start=function(){var e=this;try{r["default"].el(e),r["default"].loading(e),e.nodata.show(),r["default"].smiles(e)}catch(n){return void console.error(n)}try{e.loading.hide(e.parentCount),e.loading.show();var t=setInterval((function(){if(e.fetchCount&&("lc"!=e.conf.backend||e.setAV))if(clearInterval(t),"lc"==e.conf.backend){e.setAV(e);var n=setInterval((function(){e.v&&(clearInterval(n),a["default"].visitor(e),e.fetchCount(e),a["default"].insertComment(e,r["default"]),a["default"].parentQuery(e),a["default"].nestQuery(e))}),5)}else a["default"].visitor(e),e.fetchCount(e),a["default"].insertComment(e,r["default"]),a["default"].parentQuery(e),a["default"].nestQuery(e)}),5);a["default"].alert(e),a["default"].inputs(e),a["default"].previewEvt(e),a["default"].smileEvt(e),"DesertsP"===e.conf.mode&&a["default"].startEvt(e),e.conf.barrager&&a["default"].barrager(e),a["default"].getCache(e),a["default"].resetForm(e),a["default"].uploadImage(e),a["default"].cancelReply(e),a["default"].smileBtnEvt(e),a["default"].previewBtnEvt(e),a["default"].atEvt(e),a["default"].submitBtnEvt(e),a["default"].smile(e)}catch(n){console.error(n)}},e.exports=i},8876:function(e){e.exports=function(e){var t="[object HTMLDivElement]"===Object.prototype.toString.call(e.conf.el)?e.conf.el:document.querySelectorAll(e.conf.el)[0];"[object HTMLDivElement]"===Object.prototype.toString.call(t)&&(e.el=t,e.el.classList.add("MiniValine"),e.el.classList.add("markdown-body"),e.el.innerHTML=e.ele)}},2434:function(e,t,n){var o=n(8157),r=o(n(7807)),a=o(n(1545)),i=o(n(1062)),c=o(n(8876));e.exports={vcard:r["default"],loading:a["default"],smiles:i["default"],el:c["default"]}},1545:function(e){e.exports=function(e){var t=e.el.querySelector(".vempty");e.nodata={show:function(n){t.innerHTML=n||e.i18n.noCommentYet,t.setAttribute("style","display:block;")},hide:function(){t.setAttribute("style","display:none;")}};var n='<div class="spinner"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div></div>',o=e.el.querySelector(".vloading");o.innerHTML=n,e.loading={show:function(){o.setAttribute("style","display:block;"),e.nodata.hide()},hide:function(t){o.setAttribute("style","display:none;"),0===t&&e.nodata.show()}};var r=e.el.querySelector(".vsubmitting");r.innerHTML=n,e.submitting={show:function(){r.setAttribute("style","display:block;")},hide:function(){r.setAttribute("style","display:none;"),e.nodata.hide()}}}},1062:function(e){e.exports=function(e){var t=setInterval((function(){if("undefined"!=typeof e.emoticonList&&0!==e.emoticonList.length){clearInterval(t);for(var n=e.el.querySelector(".vsmile-icons ul"),o=e.el.querySelector(".vsmile-bar ul"),r=e.emoticonList||[],a=0;a<r.length;a++){for(var i=document.createElement("li"),c=document.createElement("li"),l=0;l<r[a].length;l++){var s=document.createElement("img");s.setAttribute("data-src","".concat(r[a][l])),s.setAttribute("class","lazyload");try{i.appendChild(s)}catch(u){}if(0===l){(s=document.createElement("img")).setAttribute("src","".concat(r[a][0])),s.removeAttribute("class","lazyload");try{c.appendChild(s)}catch(u){}}}try{n.appendChild(i)}catch(u){}try{o.appendChild(c)}catch(u){}}try{!function(){e.el.querySelector(".vsmile-icons > ul > li:nth-child(1)").style.display="block";for(var t=document.querySelectorAll(".vsmile-bar > ul > li"),n=document.querySelectorAll(".vsmile-icons > ul > li"),o=0;o<t.length;o++)t[o].index=o,t[o].onclick=function(){for(var e=0;e<t.length;e++)t[e].className="",n[e].style.display="none";this.className="active",n[this.index].style.display="block"}}()}catch(u){}}}),10)}},6844:function(e){var t=function(e){var t=n(e.getDate(),2),o=n(e.getMonth()+1,2),r=n(e.getFullYear(),2);return"".concat(r,"-").concat(o,"-").concat(t)},n=function(e,t){for(var n=e.toString();n.length<t;)n="0".concat(n);return n};e.exports=function(e,n){try{var o=e.getTime(),r=(new Date).getTime()-o,a=Math.floor(r/864e5);if(0===a){var i=r%864e5,c=Math.floor(i/36e5);if(0===c){var l=i%36e5,s=Math.floor(l/6e4);if(0===s){var u=l%6e4,d=Math.round(u/1e3);return 0===d?n.now:"".concat(d," ").concat(n.seconds)}return"".concat(s," ").concat(n.minutes)}return"".concat(c," ").concat(n.hours)}return a<0?n.now:a<365?"".concat(a," ").concat(n.days):t(e)}catch(f){console.error(f)}}},7807:function(e,t,n){var o=n(8157),r=n(196),a=o(n(6844));e.exports=function(e,t){t.get("nick")&&t.set("nick",t.get("nick").slice(0,20).trim().replace(/&/g,"&amp;").replace(/\//g,"&#x2F").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")),t.get("link")&&t.set("link",t.get("link").replace(/&/g,"&amp;").replace(/\//g,"&#x2F").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"));var n=t.get("mailMd5"),o="".concat(e.conf.avatarUrl+"/"+n,"?s=48&d=").concat(e.conf.avatarD);if(e.conf.barrager&&e.Vbarrager(e,t,o),"DesertsP"===e.conf.mode)return e.Vcard(e,t,o);if("xCss"===e.conf.mode){var i=t.get("ua")||"",c="",l=r.MVUrl+"/imgs/svg/";if((i||"waline"==e.conf.backend)&&e.conf.enableUA)try{var s="",u="";i?((i=uaparser(i)).browser&&i.browser.name&&(s=i.browser.name.toLowerCase()),i.os&&i.os.name&&(u=i.os.name.toLowerCase())):"waline"==e.conf.backend&&(s=t.get("browser").split(" ")[0].toLowerCase(),u=t.get("os").split(" ")[0].toLowerCase()),s?(c+='<span class="vsys"><i><embed class="msvg" src="'+l,["mobile","samsung","samsung browser"].includes(s)?c+="mobile-alt":["android","android browser"].includes(s)?c+="android":["mobile safari","safari"].includes(s)?c+="safari":["ie","iemobile"].includes(s)?c+="internet-explorer":["wechat"].includes(s)?c+="weixin":["qqbrowser","qqbrowserlite","qq"].includes(s)?c+="qq":["baiduboxapp","baidu"].includes(s)?c+="paw":["chrome","chromium","chrome headless","chrome webview"].includes(s)?c+="chrome":["opera mobi","opera","opera coast","opera mini","opera tablet"].includes(s)?c+="opera":["firefox","edge"].includes(s)?c+=s:c+="snapchat-ghost",i?c+='.svg"/></i>'+i.browser.name+" "+(i.browser.version?i.browser.version:"")+"</span> ":"waline"==e.conf.backend&&(c+='.svg"/></i>'+t.get("browser")+"</span>")):c+='<span class="vsys"><i><embed class="msvg" src="'+l+'stars.svg"/></i>Magical APP</span>',u?(c+='<span class="vsys"><i><embed class="msvg" src="'+l,["mac","mac os","ios"].includes(u)?c+="apple":["chromium","chromium os"].includes(u)?c+="chrome":["firefox","firefox os"].includes(u)?c+="firefox":["windows phone","windows"].includes(u)?c+="windows":["android","linux","ubuntu","suse","redhat","fedora","centos","blackberry"].includes(u)?c+=u:c+="snapchat-ghost",i?c+='.svg"/></i>'+i.os.name+" "+(i.os.version?i.os.version:"")+"</span>":"waline"==e.conf.backend&&(c+='.svg"/></i>'+t.get("os")+"</span>")):c+='<span class="vsys"><i><embed class="msvg" src="'+l+'magic.svg"/></i>Magical OS</span>'}catch(y){}if(e.conf.region)try{var d=t.get("log").region.data.location;d&&(c+='<span class="vsys"><i><embed class="msvg" src="'+l+'map.svg"/></i>'+d+"</span>")}catch(y){}var f="";if(e.conf.enableFlag&&!e.conf.cloudflag)try{e.conf.master=e.conf.master.map((function(e){return e.toLowerCase()})),e.conf.friends=e.conf.friends.map((function(e){return e.toLowerCase()}));var v=e.conf.master.includes(t.get("mailMd5").toLowerCase()),m=e.conf.friends.includes(t.get("mailMd5").toLowerCase());f=v?'<span class="vtag vmaster">'+e.conf.tagMeta[0]+"</span>":m?'<span class="vtag vfriend">'+e.conf.tagMeta[1]+"</span>":'<span class="vtag vvisitor">'+e.conf.tagMeta[2]+"</span>"}catch(y){}if(e.conf.enableFlag&&e.conf.cloudflag)try{var p=e.cloudFlag.Roles,g=t.get("mailMd5").toLowerCase(),h=e.cloudFlag.Users[g];f=h?'<span class="vtag" style="background:'+"".concat(e.cloudFlag.Roles[h]&&e.cloudFlag.Roles[h].color?e.cloudFlag.Roles[h].color:"#6cf")+';">'+"".concat(e.cloudFlag.Roles[h]&&e.cloudFlag.Roles[h].nick?e.cloudFlag.Roles[h].nick:"visitor")+"</span>":'<span class="vtag" style="background:'+"".concat(p.visitor&&p.visitor.color?p.visitor.color:"#828282")+';">'+"".concat(p.visitor&&p.visitor.nick?p.visitor.nick:"visitor")+"</span>"}catch(y){}var b='<div class="vcomment-body"><div class="vhead" >'+'<img class="vavatar lazyload" data-src="'.concat(o,'"/>')+"<a rid='".concat(t.id,"' at='@").concat(t.get("nick"),'\' class="vat" id="at-').concat(t.id,'">').concat(e.i18n.reply,"</a>")+'<div class="vmeta-info">'.concat(t.get("link")?'<a class="vname" href="'.concat(t.get("link"),'" target="_blank" rel="nofollow" > ').concat(t.get("nick"),"</a>").concat(f,'<span class="vsysinfo">').concat(c,"</span>"):'<span class="vname">'.concat(t.get("nick"),"</span> ").concat(f," ").concat(c))+'<br/><span class="vtime">'.concat((0,a["default"])(t.get("createdAt"),e.i18n),"</span>")+"</div></div>"+'<section class="text-wrapper"  id="comment-'.concat(t.id,'">');return"waline"==e.conf.backend&&(b+='<div class="comment-item" style="display: none">'.concat(window.btoa(unescape(encodeURIComponent(JSON.stringify(t)))),"</div>")),b+='<div class="vcomment">'.concat(t.get("comment"),"</div>")+'</section></div><div class="vcomment-children"><div class="vshow-children-wrapper" style="display: none"></div>'+'<ul class="vlist" id="children-list-'.concat(t.id,'"></ul>')+"</div>"}}},9506:function(e,t,n){var o=n(8157)(n(6614)),r=n(196),a=function(e){return window.MV||(console.log("%c MiniValine %c v"+r.VERSION+" ","color: white; background: #0078E7; padding:5px 0;","padding:4px;border:1px solid #0078E7;"),window.MV=Object.create(null),window.MV.v=r.VERSION),new o["default"](e)};e.exports=a,e.exports["default"]=a},1480:function(e,t,n){e.exports=function(e){e.ActivateCode=function(e){setTimeout((function(){document.getElementsByTagName("pre").length&&Promise.all([n.e(335),n.e(599),n.e(531)]).then(n.bind(n,8085))}),500),"waline"!=e.conf.backend&&e.conf.math&&n.e(600).then(n.bind(n,64)).then((function(t){(0,t.MathJaxSupport)(e)}))}}},4291:function(e,t,n){var o=n(196);e.exports=function(e){e.conf.avatarUrl=e.conf.avatarUrl?e.conf.avatarUrl.replace(/\/$/g,""):o.avatarUrl,e.conf.avatarD=e.conf.avatarD||o.avatarD,e.conf.emoticonUrl=e.conf.emoticonUrl||o.EUrl,e.conf.lang=e.conf.lang||navigator.language||navigator.userLanguage,e.conf.maxNest=e.conf.maxNest||o.MaxNL,e.conf.pageSize=e.conf.pageSize||o.PS,e.conf.adminEmailMd5=e.conf.adminEmailMd5||"",e.conf.tagMeta=e.conf.tagMeta||[],e.conf.master=e.conf.master||[],e.conf.friends=e.conf.friends||[],e.conf.mode=e.conf.mode||"xCss",e.conf.placeholder=e.conf.placeholder||"",e.C=o.C,e.conf.path=e.conf.path||e.conf.pathname||location.pathname,e.C.url=e.conf.path,e.conf.serverURLs?e.conf.serverURL=e.conf.serverURLs.replace(/\/$/g,""):e.conf.serverURL&&(e.conf.serverURL=e.conf.serverURL.replace(/\/$/g,"")),e.conf.role=e.conf.role?e.conf.role:"admin",e.conf.backend=e.conf.backend?e.conf.backend:"lc","undefined"==typeof e.conf.md&&(e.conf.md=!0)}},292:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){var t=e.el.querySelector(".vmark");e.alert={show:function(n){t.innerHTML='<div class="valert txt-center"><div class="vtext">'.concat(n.text,'</div><div class="vbtns"></div></div>');var r=t.querySelector(".vbtns"),a='<button class="vcancel vbtn">'.concat(n.ctxt||e.i18n.cancel,"</button>"),i='<button class="vsure vbtn">'.concat(n.otxt||e.i18n["continue"],"</button>");if(r.innerHTML="".concat(a).concat(n.type?i:""),t.querySelector(".vcancel").addEventListener("click",(function(t){e.alert.hide()})),t.setAttribute("style","display:block;"),n.type){var c=t.querySelector(".vsure");o["default"].on("click",c,(function(t){e.alert.hide(),n.cb&&n.cb()}))}},hide:function(){t.setAttribute("style","display:none;")}},e.error=function(t,n){console.error(t),console.error(n);var o=n;if(n.errmsg||n.message||n.msg)o=n.errmsg||n.message||n.msg;else try{o=JSON.stringify(n)}catch(r){o="ERROR"}'""'===o&&(o="network error"),e.alert.show({type:0,text:o,ctxt:e.i18n.confirm}),e.el.querySelector(".vsubmit").removeAttribute("disabled-submit"),e.submitting.hide(),e.nodata.hide(),e.reset()}}},1214:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){e.AtEvt=function(t){var n=t.getAttribute("id"),r=t.querySelector("#at-".concat(n));o["default"].on("click",r,(function(o){var a=r.getAttribute("at"),i=r.getAttribute("rid");e.C.rid=i,e.C.at=a,e.el.querySelector(".vinputs-area  textarea").placeholder=a,e.inputs.comment.value="".concat(e.inputs.comment.value);var c=t.querySelector("#comment-".concat(n));try{c.appendChild(e.el.querySelector(".vinputs-wrap"))}catch(o){}e.el.querySelector(".vcancel-comment-reply").removeAttribute("style"),"DesertsP"===e.conf.mode&&(e.el.querySelector(".commentTrigger").setAttribute("style","display:none"),e.el.querySelector(".auth-section").removeAttribute("style"),e.el.querySelector(".veditor").focus()),e.inputs.comment.focus()}))}}},6674:function(e,t,n){e.exports=function(e){window.MV.barrager={},window.MV.barrager.enable=1;var t=localStorage&&localStorage.getItem("MiniValineBarrager");t?(t=JSON.parse(t),window.MV.barrager.url=t.url):window.MV.barrager.url=[],function(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}(window.MV.barrager.url,document.location.href)||(window.MV.barrager.url.push(document.location.href),localStorage&&localStorage.setItem("MiniValineBarrager",JSON.stringify({url:window.MV.barrager.url})),n.e(83).then(n.bind(n,6664)).then((function(e){(0,e.barrager)()})))}},3288:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){o["default"].on("click",e.el.querySelector(".cancel-reply-btn"),(function(t){e.reset()}))}},3756:function(e){e.exports=function(e){var t=localStorage&&localStorage.getItem("MiniValineCache");if(t){t=JSON.parse(t);for(var n=["nick","link","mail"],o=0;o<n.length;o++){var r=n[o];e.el.querySelector(".v".concat(r)).value=t[r],e.C[r]=t[r]}""!==t.mail&&"DesertsP"===e.conf.mode&&e.el.querySelector(".visitor_avatar").setAttribute("data-src","".concat(e.conf.avatarUrl+"/"+md5(t.mail.toLowerCase().trim()),"?s=48&d=").concat(e.conf.avatarD))}}},8447:function(e,t,n){var o=n(8157),r=n(196),a=o(n(4460));e.exports=function(e){if(window.MV.i18n)e.i18n=window.MV.i18n,window.MV.getI18n=0;else{var t=localStorage&&localStorage.getItem("MiniValineI18n");if(t&&(t=JSON.parse(t)).lang==e.conf.lang?(e.i18n=t.i18n,window.MV.i18n=e.i18n,window.MV.getI18n=0):window.MV.getI18n=1,window.MV.getI18n){var n=e.conf.lang.split("-");2==n.length&&(e.conf.lang=n[0]+"-"+n[1].toUpperCase()),(0,a["default"])({url:r.i18nUrl+e.conf.lang+"/index.json",type:"GET",success:function(t){e.i18n=t,window.MV.i18n=e.i18n,localStorage&&localStorage.setItem("MiniValineI18n",JSON.stringify({lang:e.conf.lang,i18n:e.i18n}))}})}}}},7375:function(e,t,n){var o=n(8157),r=o(n(4291)),a=o(n(8447)),i=o(n(2285)),c=o(n(2716)),l=o(n(7574)),s=o(n(1401)),u=o(n(3604)),d=o(n(292)),f=o(n(3756)),v=o(n(2682)),m=o(n(4464)),p=o(n(673)),g=o(n(3288)),h=o(n(5320)),b=o(n(7866)),y=o(n(8183)),w=o(n(1214)),S=o(n(3952)),x=o(n(4425)),k=o(n(6346)),M=o(n(9010)),C=o(n(1480)),A=o(n(756)),E=o(n(7762)),q=o(n(6674));e.exports={Config:r["default"],i18n:a["default"],smile:i["default"],script:c["default"],initStyle:l["default"],initLibs:s["default"],uploadImage:u["default"],alert:d["default"],smileEvt:v["default"],startEvt:m["default"],resetForm:p["default"],cancelReply:g["default"],smileBtnEvt:h["default"],previewBtnEvt:b["default"],inputs:y["default"],atEvt:w["default"],submitBtnEvt:S["default"],insertComment:x["default"],nestQuery:k["default"],parentQuery:M["default"],ActivateCode:C["default"],previewEvt:A["default"],visitor:E["default"],barrager:q["default"],getCache:f["default"]}},1401:function(e,t,n){e.exports=function(e){var t=setInterval((function(){"undefined"!=typeof Promise&&(clearInterval(t),Promise.all([n.e(335),n.e(983),n.e(647)]).then(n.bind(n,8522)).then((function(t){(0,t.lib)(e),"lc"==e.conf.backend?Promise.all([n.e(501),n.e(714)]).then(n.bind(n,1509)).then((function(t){(0,t.lib)(),e.initCheck()})):e.initCheck()})))}),5)}},7574:function(e,t,n){e.exports=function(e){if(!e.conf.closeCSS)var t=setInterval((function(){"undefined"!=typeof Promise&&(clearInterval(t),"DesertsP"===e.conf.mode?Promise.all([n.e(335),n.e(526)]).then(n.bind(n,6893)):"xCss"===e.conf.mode&&Promise.all([n.e(335),n.e(456)]).then(n.bind(n,6321)),e.conf.barrager&&Promise.all([n.e(335),n.e(974)]).then(n.bind(n,6391)),e.conf.dark&&Promise.all([n.e(335),n.e(487)]).then(n.bind(n,387)),"waline"==e.conf.backend&&Promise.all([n.e(335),n.e(482)]).then(n.bind(n,5492)))}),5)}},8183:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){for(var t in e.inputs=Object.create(null),e.mapping={veditor:"comment",vnick:"nick",vlink:"link",vmail:"mail"},e.mapping)e.mapping.hasOwnProperty(t)&&function(){var n=e.mapping[t],r=e.el.querySelector(".".concat(t));e.inputs[n]=r,o["default"].on("input",r,(function(t){e.C[n]=r.value,e.previewEvt(e)}))}()}},9270:function(e){e.exports=function(e,t){if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,o=e.selectionEnd,r=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=r}else e.focus(),e.value+=t}},4425:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e,t){e.insertComment=function(o){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null,a=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2],i=document.createElement("li");i.setAttribute("class","vcard"),i.setAttribute("id",o.id),i.innerHTML=t.vcard(e,o),e.ActivateCode(e);for(var c=r||e.el.querySelector(".vlist"),l=c.querySelectorAll("li"),s=i.querySelectorAll("a"),u=0,d=s.length;u<d;u++){var f=s[u];f&&"at"!==f.getAttribute("class")&&(f.setAttribute("target","_blank"),f.setAttribute("rel","nofollow"))}if(a)c.insertBefore(i,l[0]);else try{c.appendChild(i)}catch(m){}var v=i.querySelector(".vcomment");return n(v),e.AtEvt(i),i};var n=function(e){e.offsetHeight>180&&(e.classList.add("expand"),o["default"].on("click",e,(function(t){e.setAttribute("class","vcomment")})))}}},6346:function(e,t,n){var o=n(8157),r=o(n(9493)),a=o(n(3195));e.exports=function(e){e.nestQuery=function(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1,o=t.querySelector(".vcomment-children"),i=o.querySelector(".vlist"),c=t.getAttribute("id");if(n<=0&&o.setAttribute("style","margin-left: 0 !important"),n>=e.conf.maxNest){var l=function(n){if(n>0){var a=o.querySelector(".vshow-children-wrapper");a.setAttribute("style","display: block !important;"),a.innerHTML='<span class="vshow-children" rid="'.concat(c,'">').concat(e.i18n.more,"</span>");var i=a.querySelector(".vshow-children");r["default"].on("click",i,(function(n){a.setAttribute("style","display: none !important;"),e.nestQuery(t,-1e3)}))}};e.fetchNextCount(e,c,l)}else setTimeout((function(){e.fetchNextList(e,c,(function(t){var o=t.length;if(o)for(var r=function(o){t[o].get("isSpam")||(t[o].TEXT=t[o].get("comment"),"waline"==e.conf.backend&&(t[o].NOXSS=!0),(0,a["default"])(t[o],(function(r){t[o].set("comment",r.TEXT);var a=e.insertComment(t[o],i,!0);e.nestQuery(a,n+1)})))},c=0;c<o;c++)r(c)}))}),60*n)}}},9010:function(e,t,n){var o=n(8157),r=o(n(9493)),a=o(n(3195));e.exports=function(e){var t=1;e.TotalPages=0,e.parentQuery=function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;e.loading.show();var o=function(o){var i=o.length;if(i){for(var c=function(t){if(0==t&&e.loading.hide(e.TotalPages),o[t].get("isSpam"))return"continue";o[t].TEXT=o[t].get("comment"),"waline"==e.conf.backend&&(o[t].NOXSS=!0),(0,a["default"])(o[t],(function(n){o[t].set("comment",n.TEXT);var r=e.insertComment(o[t],e.el.querySelector(".vlist"),!1);r.setAttribute("style","margin-bottom: .5em"),e.nestQuery(r)}))},l=0;l<i;l++)c(l);var s=e.el.querySelector(".vpage");s.innerHTML=n<e.TotalPages?'<div id="vmore" class="more">'.concat(e.i18n.more,"</div>"):"";var u=s.querySelector("#vmore");u&&r["default"].on("click",u,(function(n){s.innerHTML="",e.parentQuery(++t)}))}try{"undefined"!=typeof window.MV.barrager.bottom&&1==e.conf.barrager&&(window.MV.barrager.enable=0)}catch(d){}e.loading.hide(e.TotalPages)};e.fetchParentList(e,n,o)},e.fetchTotalPages(e,(function(t){e.TotalPages=t,e.parentQuery(1)}))}},8301:function(e,t,n){var o=n(8157)(n(4460));e.exports=function(e){try{(0,o["default"])({url:"https://ip.zxinc.org/api.php",type:"GET",data:{type:"json"},success:function(t){window.MV.region=t,e.C.ip=t.data.myip,window.MV.ip=e.C.ip}})}catch(t){}}},2243:function(e,t,n){var o=n(8157)(n(2162));e.exports=function(e,t,n){var r=e.C.comment.match(/!\(:(.*?\.\w+):\)/g);if(r)for(var a=0;a<r.length;a++){var i=r[a].match(/!\(:(.*?\.\w+):\)/)[1],c=e.emoticon[i],l=new RegExp("!\\(:"+i.replace(/\./,"\\.")+":\\)","g");"lc"==e.conf.backend?e.C.comment=e.C.comment.replace(l,'<img src="'.concat(c,'" alt="').concat(i,'" class="vemoticon-img">')):"waline"==e.conf.backend&&(e.C.comment=e.C.comment.replace(l,"![".concat(i,"](").concat(c,")")))}t.TEXT=e.C.comment,(0,o["default"])(e,t,n)}},2162:function(e,t,n){var o=n(8157)(n(3195));e.exports=function(e,t,r){("waline"==e.conf.backend&&t.preview||"lc"==e.conf.backend)&&e.conf.md?Promise.all([n.e(599),n.e(853),n.e(685)]).then(n.bind(n,8394)).then((function(e){var n=e.markdown;t.TEXT=n(t.TEXT),(0,o["default"])(t,r)})):(0,o["default"])(t,r)}},4460:function(e){var t=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")};e.exports=function(e){(e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json";var n=t(e.data),o=null;(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4===o.readyState){var t=o.status,n=o.responseText,r=o.responseXML;try{n=JSON.parse(n),r=JSON.parse(r)}catch(a){n&&(console.error(n),console.error(a))}if(t>=200&&t<300){if(e.success)try{e.success(n,r)}catch(a){n&&(console.error(n),console.error(a))}}else e.error&&e.error(t,n)}},"GET"==e.type?(o.open("GET",e.url+"?"+n,!0),o.send(null)):"POST"==e.type&&(o.open("POST",e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n))}},3755:function(e){e.exports={mail:function(e){return{k:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e),v:e}},link:function(e){return e.length>0&&(e=/^(http|https)/.test(e)?e:"http://".concat(e)),{k:!(e.length>0)||/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/.test(e),v:e}}}},9493:function(e){var t={on:function(e,n,o,r){for(var a=0,i=(e=e.split(" ")).length;a<i;a++)t.off(e[a],n,o,r),n.addEventListener?n.addEventListener(e[a],o,r||!1):n.attachEvent?n.attachEvent("on".concat(e[a]),o):n["on".concat(e[a])]=o},off:function(e,t,n,o){for(var r=0,a=(e=e.split(" ")).length;r<a;r++)t.removeEventListener?t.removeEventListener(e,n,o||!1):t.detachEvent?t.detachEvent("on".concat(e),n):t["on".concat(e)]=null}};e.exports=t},1983:function(e){e.exports=function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e;try{document.getElementsByTagName("head")[0].appendChild(t)}catch(n){}}},3195:function(e,t,n){e.exports=function(e,t){e.NOXSS?t(e):Promise.all([n.e(252),n.e(186)]).then(n.bind(n,2847)).then((function(n){var o=n.XSS;e.TEXT=o(e.TEXT),t(e)}))}},7866:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){var t=e.el.querySelector(".vpreview-btn"),n=e.el.querySelector(".vemoji-btn"),r=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".vsmile-icons");o["default"].on("click",t,(function(o){if(a.getAttribute("triggered")&&(a.setAttribute("style","display:none;"),a.removeAttribute("triggered"),n.classList.remove("actived")),r.getAttribute("triggered"))r.setAttribute("style","display:none;"),r.removeAttribute("triggered"),t.classList.remove("actived");else{if(t.classList.add("actived"),""===e.C.comment)return void e.inputs.comment.focus();e.previewEvt(e)}}))}},756:function(e,t,n){var o=n(8157)(n(2243));e.exports=function(e){e.previewEvt=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,n=e.el.querySelector(".vpreview-btn"),r=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".veditor"),i=function(o){o.preview=!0,o.innerHTML=o.TEXT,o.removeAttribute("style"),o.setAttribute("triggered",1),n.classList.add("actived"),a.value?autosize(a):autosize.destroy(a),e.ActivateCode(e,t)};(0,o["default"])(e,r,i)}}},673:function(e,t,n){var o=n(8157)(n(3756));e.exports=function(e){var t=e.el.querySelector(".vsmile-icons"),n=e.el.querySelector(".vpreview-text");e.reset=function(){for(var r in e.mapping)if(e.mapping.hasOwnProperty(r)){var a=e.mapping[r];e.el.querySelector(".".concat(r)).value="",e.C[a]=""}e.C.rid="",e.C.nick="",e.C.at="",e.el.querySelector(".vinputs-area  textarea").placeholder="",(0,o["default"])(e),e.previewEvt(e),t.getAttribute("triggered")&&(t.setAttribute("style","display:none;"),t.removeAttribute("triggered")),n.getAttribute("triggered")&&(n.setAttribute("style","display:none;"),n.removeAttribute("triggered")),e.el.querySelector(".vcancel-comment-reply").setAttribute("style","display:none");try{e.el.querySelector("#vinputs-placeholder").appendChild(e.el.querySelector(".vinputs-wrap"))}catch(i){}}}},2716:function(e,t,n){var o=n(8157),r=n(196),a=o(n(1983)),i=o(n(8301));e.exports=function(e){"lc"==e.conf.backend&&e.conf.RecordIP&&("undefined"==typeof window.MV.ip?(0,i["default"])(e):e.C.ip=window.MV.ip),"undefined"==typeof window.MV.pf&&((0,a["default"])(r.pf),window.MV.pf=!0),e.conf.barrager&&"undefined"==typeof window.MV.jq&&("undefined"==typeof jQuery&&(0,a["default"])("https://cdn.jsdelivr.net/npm/jquery"),window.MV.jq=!0),"lc"==e.conf.backend&&e.conf.visitor&&(0,a["default"])("https://cdn.jsdelivr.net/npm/fingerprintjs2")}},2285:function(e,t,n){var o=n(8157)(n(4460)),r=function(e,t){(0,o["default"])({url:t.replace(/\/$/g,"")+"/index.json",type:"GET",success:function(n){for(var o=[],r=0;r<n[0].length;r++)o.push(t+"/"+n[0][r]),e.emoticon[n[0][r]]=t+"/"+n[0][r];e.emoticonList.push(o)}})};e.exports=function(e){if(window.MV.emoticonUrl=e.conf.emoticonUrl,!window.MV.emoticonList){var t=localStorage&&localStorage.getItem("MiniValineSmile");if(t)if(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}((t=JSON.parse(t)).emoticonUrl,e.conf.emoticonUrl)){e.emoticonList=t.emoticonList,e.emoticon=[];for(var n=0;n<e.emoticonList.length;n++)for(var o=0;o<e.emoticonList[n].length;o++)e.emoticon[e.emoticonList[n][o].split("/")[e.emoticonList[n][o].split("/").length-1]]=e.emoticonList[n][o];window.MV.emoticonList=e.emoticonList,window.MV.emoticon=e.emoticon,window.MV.getSmile=0}else window.MV.getSmile=1;else window.MV.getSmile=1;if(window.MV.getSmile){e.emoticonList=[],e.emoticon=[];for(var a=0;a<e.conf.emoticonUrl.length;a++)r(e,e.conf.emoticonUrl[a]);window.MV.emoticonList=e.emoticonList,window.MV.emoticon=e.emoticon}else e.emoticonList=window.MV.emoticonList,e.emoticon=window.MV.emoticon;setTimeout((function(){"undefined"!=typeof e.emoticonList&&0!=e.emoticonList.length&&localStorage&&localStorage.setItem("MiniValineSmile",JSON.stringify({emoticonUrl:window.MV.emoticonUrl,emoticonList:window.MV.emoticonList}))}),5e3)}}},5320:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){var t=e.el.querySelector(".vemoji-btn"),n=e.el.querySelector(".vpreview-btn"),r=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".vsmile-body");o["default"].on("click",t,(function(e){r.getAttribute("triggered")&&(r.setAttribute("style","display:none;"),r.removeAttribute("triggered"),n.classList.remove("actived")),a.getAttribute("triggered")?(a.setAttribute("style","display:none;"),a.removeAttribute("triggered"),t.classList.remove("actived")):(a.removeAttribute("style"),a.setAttribute("triggered",1),t.classList.add("actived"))}))}},2682:function(e,t,n){var o=n(8157),r=o(n(9493)),a=o(n(9270));e.exports=function(e){var t=e.el.querySelector(".vsmile-icons");r["default"].on("click",t,(function(t){var n=e.el.querySelector(".veditor"),o=t.target.src;if(void 0!==o){var r="!(:".concat(decodeURI(o).replace(/^.*\/(.*)$/,"$1"),":)");(0,a["default"])(n,r),e.C.comment=n.value;var i=e.el.querySelector(".vsubmit");i.getAttribute("disabled")&&i.removeAttribute("disabled")}}))}},4464:function(e,t,n){var o=n(8157)(n(9493));e.exports=function(e){var t=e.el.querySelector(".commentTrigger");o["default"].on("click",t,(function(n){t.setAttribute("style","display:none"),e.el.querySelector(".auth-section").removeAttribute("style"),e.el.querySelector(".veditor").focus()}))}},3952:function(e,t,n){var o=n(8157),r=o(n(9493)),a=o(n(2243)),i=o(n(3755));e.exports=function(e){var t=e.el.querySelector(".vsubmit");e.submitEvt=function(o){t.getAttribute("disabled-submit")?e.alert.show({type:0,text:e.i18n.wait+'ヾ(๑╹◡╹)ﾉ"',ctxt:e.i18n.ok}):""!==e.C.comment?""!==e.C.nick?(0,a["default"])(e,e,(function(e){if(e.C.comment=e.TEXT,"lc"==e.conf.backend&&""!==e.C.at){var t='<a class="at" href=\'#'.concat(e.C.rid,"'>").concat(e.C.at,"</a>");e.C.comment=t+" , "+e.C.comment}var o=i["default"].mail(e.C.mail),r=i["default"].link(e.C.link);e.C.mail=o.k?o.v:"",e.C.link=r.k?r.v:"",e.C.mailMd5=md5(e.C.mail),o.k&&r.k?n():e.alert.show({type:0,text:e.i18n.inputTips,ctxt:e.i18n.confirm})})):e.inputs.nick.focus():e.inputs.comment.focus()};var n=function(){t.setAttribute("disabled-submit",!0),e.submitting.show(),e.postComment(e,(function(n){localStorage&&localStorage.setItem("MiniValineCache",JSON.stringify({nick:e.C.nick,link:e.C.link,mail:e.C.mail}));var o=e.el.querySelector(".count");if(o.innerText=Number(o.innerText)+1,""===e.C.rid)e.insertComment(n,null,!0);else{var r=e.el.querySelector("#children-list-".concat(e.C.rid));e.insertComment(n,r,!0)}t.removeAttribute("disabled-submit"),e.submitting.hide(),e.nodata.hide(),e.reset()}))};r["default"].on("click",t,e.submitEvt)}},3604:function(e,t,n){var o=n(8157),r=o(n(9493)),a=o(n(9270));e.exports=function(e){var t=e.el.querySelector(".veditor");r["default"].on("keydown",document,(function(n){var o=(n=event||n).keyCode||n.which||n.charCode;(n.ctrlKey||n.metaKey)&&13===o&&e.submitEvt(),9===o&&"veditor"==(document.activeElement.className||"")&&(n.preventDefault(),(0,a["default"])(t,"    "))}));var n=function(n){if(n.length)for(var r=function(r){var i=n[r],c="![Uploading ".concat(i.name,"]()");(0,a["default"])(t,c),o(i,(function(n,o){!n&&o&&(t.value=t.value.replace(c,"\r\n![".concat(i.name,"](").concat(o.data.url,")")),e.C.comment=t.value)}))},i=0;i<n.length;i++)r(i)};r["default"].on("paste",document,(function(e){var t="clipboardData"in e?e.clipboardData:e.originalEvent&&e.originalEvent.clipboardData||window.clipboardData,o=t&&t.items,r=[];if(o&&o.length>0){for(var a=0;a<o.length;a++)if(-1!==o[a].type.indexOf("image")){r.push(o[a].getAsFile());break}n(r)}}));var o=function(e,t){var n=new FormData;n.append("image",e);var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");o.onreadystatechange=function(){if(4===o.readyState&&200===o.status)try{var e=JSON.parse(o.responseText);t&&t(null,e)}catch(n){t&&t(n)}else t&&t(o.status)},o.onerror=function(e){console.error(e)},o.open("POST","https://pic.alexhchu.com/api/upload",!0),o.send(n)},i=document.getElementsByClassName("veditor")[0];i.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),i.addEventListener("dragenter",(function(e){e.preventDefault(),e.stopPropagation()})),i.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation();var t=this.files||e.dataTransfer.files;n(t)}))}},7762:function(e,t,n){e.exports=function(e){e.conf.visitor&&n.e(707).then(n.bind(n,239)).then((function(t){(0,t.MCo)(e.conf)}))}}},o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={id:e,loaded:!1,exports:{}};return n[e](t,t.exports,r),t.loaded=!0,t.exports}return r.m=n,r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"MiniValine."+{83:"barrager",92:"fetch-waline-counter",186:"xss",220:"fetch-lc-CloudFlag",252:"npm.xss",290:"body-xCss",335:"npm.style-loader",401:"fetch-lc-base",456:"style-xCss",482:"style-math",487:"style-dark",501:"npm.leancloud-storage",526:"style-DesertsP",531:"md-style",599:"npm.highlight.js",600:"math",643:"fetch-lc-counter",647:"lib",685:"md",707:"visitor",714:"lib-av",840:"vcard-DesertsP",843:"vcard-barrager",853:"npm.marked",864:"fetch-waline-base",940:"body-DesertsP",974:"style-barrager",983:"npm.lazysizes",999:"ua"}[e]+".min.js"},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="MiniValine:",r.l=function(n,o,a){if(e[n])e[n].push(o);else{var i,c;if(a!==undefined)for(var l=document.getElementsByTagName("script"),s=0;s<l.length;s++){var u=l[s];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+a){i=u;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+a),i.src=n),e[n]=[o];var d=function(t,o){i.onerror=i.onload=null,clearTimeout(f);var r=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(o)})),t)return t(o)},f=setTimeout(d.bind(null,undefined,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),c&&document.head.appendChild(i)}},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},r.p="https://cdn.jsdelivr.net/npm/minivaline@5.1.7/dist/",function(){var e={554:0};r.f.j=function(t,n){var o=r.o(e,t)?e[t]:undefined;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise((function(n,r){o=e[t]=[n,r]}));n.push(o[2]=a);var i=r.p+r.u(t),c=new Error;r.l(i,(function(n){if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=undefined),o)){var a=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;c.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,o[1](c)}}),"chunk-"+t)}};var t=function(t,n){for(var o,a,i=n[0],c=n[1],l=n[2],s=0,u=[];s<i.length;s++)a=i[s],r.o(e,a)&&e[a]&&u.push(e[a][0]),e[a]=0;for(o in c)r.o(c,o)&&(r.m[o]=c[o]);for(l&&l(r),t&&t(n);u.length;)u.shift()()},n=self.webpackChunkMiniValine=self.webpackChunkMiniValine||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),r(9506)}()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MiniValine",[],t):"object"==typeof exports?exports.MiniValine=t():e.MiniValine=t();