!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MiniValine",[],t):"object"==typeof exports?exports.MiniValine=t():e.MiniValine=t()}(self,(function(){return(()=>{"use strict";var e,t,n={196:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=t.VERSION="5.0.0-alpha.3",i=t.MVUrl="https://cdn.jsdelivr.net/npm/minivaline@"+n;t.GBUrl="https://gravatar.loli.net/avatar/",t.EUrl=[i+"/imgs/alus",i+"/imgs/qq",i+"/imgs/Bilibilis",i+"/imgs/tieba",i+"/imgs/twemoji",i+"/imgs/weibo",i+"/imgs/funny"],t.pf="https://cdn.polyfill.io/v3/polyfill.min.js?features=es6",t.i18nUrl=i+"/i18n/",t.DEHash="9e63c80900d106cbbec5a9f4ea433a3e",t.MaxNL=6,t.PS=6,t.C={ip:"",comment:"",rid:"",at:"",nick:"",mail:"",mailMd5:"",link:"",ua:navigator.userAgent,url:location.pathname}},6614:(e,t,n)=>{var i=o(n(2434)),a=o(n(7375));function o(e){return e&&e.__esModule?e:{default:e}}var r=function(e){var t=this;try{if(t.config=e,!document.querySelectorAll(t.config.el)[0])return;a.default.Config(t),a.default.initStyle(t),a.default.ActivateCode(t),a.default.script(t),a.default.i18n(t),a.default.initLibs(t)}catch(e){console.log(e)}};r.prototype.initCheck=function(){var e=this;try{var t=setInterval((function(){e.i18n&&(clearInterval(t),"lc"==e.backend?(n.e(401).then(n.bind(n,4593)).then((function(t){(0,t.FetchBase)(e)})),e.config.cloudflag&&n.e(220).then(n.bind(n,5365)).then((function(t){(0,t.FetchCloudFlag)(e)}))):"waline"==e.backend&&n.e(864).then(n.bind(n,306)).then((function(t){(0,t.FetchBase)(e)})),"DesertsP"===e.mode?(n.e(940).then(n.bind(n,1268)).then((function(t){var n=t.getEle;e.ele=n(e),e.Start()})),n.e(840).then(n.bind(n,8535)).then((function(t){var n=t.Vcard;e.Vcard=n(e)}))):"xCss"===e.mode&&(e.config.closeUA||n.e(999).then(n.bind(n,3006)).then((function(e){(0,e.init)()})),n.e(290).then(n.bind(n,8223)).then((function(t){var n=t.getEle;e.ele=n(e),e.Start()}))),(void 0===e.config.barrager||e.config.barrager)&&n.e(843).then(n.bind(n,2241)).then((function(t){var n=t.Vbarrager;e.Vbarrager=n(e)})))}),5)}catch(e){console.log(e)}},r.prototype.Start=function(){var e=this;try{i.default.el(e),i.default.loading(e),e.nodata.show(),i.default.smiles(e),"lc"==e.backend&&e.setAV(e),a.default.visitor(e)}catch(e){return void console.log(e)}try{e.loading.hide(e.parentCount),e.loading.show(),e.fetchCount(e),a.default.insertComment(e,i.default),a.default.parentQuery(e),a.default.nestQuery(e),a.default.alert(e),a.default.inputs(e),a.default.previewEvt(e),a.default.smileEvt(e),"DesertsP"===e.mode&&a.default.startEvt(e),(void 0===e.config.barrager||e.config.barrager)&&a.default.barrager(e),a.default.getCache(e),a.default.resetForm(e),a.default.uploadImage(e),a.default.cancelReply(e),a.default.smileBtnEvt(e),a.default.previewBtnEvt(e),a.default.atEvt(e),a.default.submitBtnEvt(e),a.default.smile(e)}catch(e){console.log(e)}},e.exports=r},8876:e=>{e.exports=function(e){var t="[object HTMLDivElement]"===Object.prototype.toString.call(e.config.el)?e.config.el:document.querySelectorAll(e.config.el)[0];"[object HTMLDivElement]"===Object.prototype.toString.call(t)&&(e.el=t,e.el.classList.add("MiniValine"),e.el.classList.add("markdown-body"),e.el.innerHTML=e.ele)}},2434:(e,t,n)=>{var i=l(n(7807)),a=l(n(1545)),o=l(n(1062)),r=l(n(8876));function l(e){return e&&e.__esModule?e:{default:e}}e.exports={vcard:i.default,loading:a.default,smiles:o.default,el:r.default}},1545:e=>{e.exports=function(e){var t=e.el.querySelector(".vempty");e.nodata={show:function(n){t.innerHTML=n||e.i18n.noCommentYet,t.setAttribute("style","display:block;")},hide:function(){t.setAttribute("style","display:none;")}};var n='<div class="spinner"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div></div>',i=e.el.querySelector(".vloading");i.innerHTML=n,e.loading={show:function(){i.setAttribute("style","display:block;"),e.nodata.hide()},hide:function(t){i.setAttribute("style","display:none;"),0===t&&e.nodata.show()}};var a=e.el.querySelector(".vsubmitting");a.innerHTML=n,e.submitting={show:function(){a.setAttribute("style","display:block;")},hide:function(){a.setAttribute("style","display:none;"),e.nodata.hide()}}}},1062:e=>{e.exports=function(e){var t=setInterval((function(){if(void 0!==e.emoticonList&&0!==e.emoticonList.length){clearInterval(t);for(var n=e.el.querySelector(".vsmile-icons ul"),i=e.el.querySelector(".vsmile-bar ul"),a=e.emoticonList||[],o=0;o<a.length;o++){for(var r=document.createElement("li"),l=document.createElement("li"),c=0;c<a[o].length;c++){var s=document.createElement("img");s.setAttribute("data-src","".concat(a[o][c])),s.setAttribute("class","lazyload");try{r.appendChild(s)}catch(e){}if(0===c){(s=document.createElement("img")).setAttribute("src","".concat(a[o][0])),s.removeAttribute("class","lazyload");try{l.appendChild(s)}catch(e){}}}try{n.appendChild(r)}catch(e){}try{i.appendChild(l)}catch(e){}}try{!function(){e.el.querySelector(".vsmile-icons > ul > li:nth-child(1)").style.display="block";for(var t=document.querySelectorAll(".vsmile-bar > ul > li"),n=document.querySelectorAll(".vsmile-icons > ul > li"),i=0;i<t.length;i++)t[i].index=i,t[i].onclick=function(){for(var e=0;e<t.length;e++)t[e].className="",n[e].style.display="none";this.className="active",n[this.index].style.display="block"}}()}catch(e){}}}),10)}},6844:e=>{var t=function(e){var t=n(e.getDate(),2),i=n(e.getMonth()+1,2),a=n(e.getFullYear(),2);return"".concat(a,"-").concat(i,"-").concat(t)},n=function(e,t){for(var n=e.toString();n.length<t;)n="0".concat(n);return n};e.exports=function(e,n){try{var i=e.getTime(),a=(new Date).getTime()-i,o=Math.floor(a/864e5);if(0===o){var r=a%864e5,l=Math.floor(r/36e5);if(0===l){var c=r%36e5,s=Math.floor(c/6e4);if(0===s){var d=c%6e4,u=Math.round(d/1e3);return 0===u?n.now:"".concat(u," ").concat(n.seconds)}return"".concat(s," ").concat(n.minutes)}return"".concat(l," ").concat(n.hours)}return o<0?n.now:o<365?"".concat(o," ").concat(n.days):t(e)}catch(e){console.log(e)}}},7807:(e,t,n)=>{var i,a=n(196),o=n(6844),r=(i=o)&&i.__esModule?i:{default:i};e.exports=function(e,t){t.set("nick",t.get("nick").slice(0,20).trim().replace(/&/g,"&amp;").replace(/\//g,"&#x2F").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"));var n=t.get("mailMd5"),i="".concat(a.GBUrl+n,"?size=80&d=robohash");if((void 0===e.config.barrager||e.config.barrager)&&e.Vbarrager(e,t,i),"DesertsP"===e.mode)return e.Vcard(e,t,i);if("xCss"===e.mode){var o=t.get("ua")||"",l="",c=a.MVUrl+"/imgs/svg/";if((o||"waline"==e.backend)&&!e.config.closeUA)try{var s="",d="";o?((o=uaparser(o)).browser&&o.browser.name&&(s=o.browser.name.toLowerCase()),o.os&&o.os.name&&(d=o.os.name.toLowerCase())):"waline"==e.backend&&(s=t.get("browser").split(" ")[0].toLowerCase(),d=t.get("os").split(" ")[0].toLowerCase()),s?(l+='<span class="vsys"><i><embed class="msvg" src="'+c,["mobile","samsung","samsung browser"].includes(s)?l+="mobile-alt":["android","android browser"].includes(s)?l+="android":["mobile safari","safari"].includes(s)?l+="safari":["ie","iemobile"].includes(s)?l+="internet-explorer":["wechat"].includes(s)?l+="weixin":["qqbrowser","qqbrowserlite","qq"].includes(s)?l+="qq":["baiduboxapp","baidu"].includes(s)?l+="paw":["chrome","chromium","chrome headless","chrome webview"].includes(s)?l+="chrome":["opera mobi","opera","opera coast","opera mini","opera tablet"].includes(s)?l+="opera":["firefox","edge"].includes(s)?l+=s:l+="snapchat-ghost",o?l+='.svg"/></i>'+o.browser.name+" "+(o.browser.version?o.browser.version:"")+"</span> ":"waline"==e.backend&&(l+='.svg"/></i>'+t.get("browser")+"</span>")):l+='<span class="vsys"><i><embed class="msvg" src="'+c+'stars.svg"/></i>Magical APP</span>',d?(l+='<span class="vsys"><i><embed class="msvg" src="'+c,["mac","mac os","ios"].includes(d)?l+="apple":["chromium","chromium os"].includes(d)?l+="chrome":["firefox","firefox os"].includes(d)?l+="firefox":["windows phone","windows"].includes(d)?l+="windows":["android","linux","ubuntu","suse","redhat","fedora","centos","blackberry"].includes(d)?l+=d:l+="snapchat-ghost",o?l+='.svg"/></i>'+o.os.name+" "+(o.os.version?o.os.version:"")+"</span>":"waline"==e.backend&&(l+='.svg"/></i>'+t.get("os")+"</span>")):l+='<span class="vsys"><i><embed class="msvg" src="'+c+'magic.svg"/></i>Magical OS</span>'}catch(e){}if(e.config.region)try{var u=t.get("log").region.data.location;u&&(l+='<span class="vsys"><i><embed class="msvg" src="'+c+'map.svg"/></i>'+u+"</span>")}catch(e){}var f="";if(!e.config.closeFlag&&!e.config.cloudflag)try{e.master=e.master.map((function(e){return e.toLowerCase()})),e.friends=e.friends.map((function(e){return e.toLowerCase()}));var v=e.master.includes(t.get("mailMd5").toLowerCase()),m=e.friends.includes(t.get("mailMd5").toLowerCase());f=v?'<span class="vtag vmaster">'+e.tagMeta[0]+"</span>":m?'<span class="vtag vfriend">'+e.tagMeta[1]+"</span>":'<span class="vtag vvisitor">'+e.tagMeta[2]+"</span>"}catch(e){}if(!e.config.closeFlag&&e.config.cloudflag)try{var p=e.cloudFlag.Roles,g=t.get("mailMd5").toLowerCase(),h=e.cloudFlag.Users[g];f=h?'<span class="vtag" style="background:'+"".concat(e.cloudFlag.Roles[h]&&e.cloudFlag.Roles[h].color?e.cloudFlag.Roles[h].color:"#6cf")+';">'+"".concat(e.cloudFlag.Roles[h]&&e.cloudFlag.Roles[h].nick?e.cloudFlag.Roles[h].nick:"visitor")+"</span>":'<span class="vtag" style="background:'+"".concat(p.visitor&&p.visitor.color?p.visitor.color:"#828282")+';">'+"".concat(p.visitor&&p.visitor.nick?p.visitor.nick:"visitor")+"</span>"}catch(e){}var b='<div class="vcomment-body"><div class="vhead" >'+'<img class="vavatar lazyload" data-src="'.concat(i,'"/>')+"<a rid='".concat(t.id,"' at='@").concat(t.get("nick"),'\' class="vat" id="at-').concat(t.id,'">').concat(e.i18n.reply,"</a>")+'<div class="vmeta-info">'.concat(t.get("link")?'<a class="vname" href="'.concat(t.get("link"),'" target="_blank" rel="nofollow" > ').concat(t.get("nick"),"</a>").concat(f,'<span class="vsysinfo">').concat(l,"</span>"):'<span class="vname">'.concat(t.get("nick"),"</span> ").concat(f," ").concat(l))+'<br/><span class="vtime">'.concat((0,r.default)(t.get("createdAt"),e.i18n),"</span>")+"</div></div>"+'<section class="text-wrapper"  id="comment-'.concat(t.id,'">');return"waline"==e.backend&&(b+='<div class="comment-item" style="display: none">'.concat(window.btoa(unescape(encodeURIComponent(JSON.stringify(t)))),"</div>")),b+='<div class="vcomment">'.concat(t.get("comment"),"</div>")+'</section></div><div class="vcomment-children"><div class="vshow-children-wrapper" style="display: none"></div>'+'<ul class="vlist" id="children-list-'.concat(t.id,'"></ul>')+"</div>"}}},9506:(e,t,n)=>{var i,a=n(6614),o=(i=a)&&i.__esModule?i:{default:i},r=n(196);var l=function(e){return window.MV||(console.log("%c MiniValine %c v"+r.VERSION+" ","color: white; background: #0078E7; padding:5px 0;","padding:4px;border:1px solid #0078E7;"),window.MV=Object.create(null),window.MV.v=r.VERSION),new o.default(e)};e.exports=l,e.exports.default=l},1480:(e,t,n)=>{e.exports=function(e){e.ActivateCode=function(e){setTimeout((function(){document.getElementsByTagName("pre").length&&Promise.all([n.e(335),n.e(599),n.e(531)]).then(n.bind(n,8085))}),500),0!=e.math&&n.e(600).then(n.bind(n,64)).then((function(t){(0,t.MathJaxSupport)(e)}))}}},4291:(e,t,n)=>{var i=n(196);e.exports=function(e){e.emoticonUrl=e.config.emoticonUrl||i.EUrl,e.lang=e.config.lang||navigator.language||navigator.userLanguage,e.maxNestLevel=e.config.maxNest||i.MaxNL,e.pageSize=e.config.pageSize||i.PS,e.adminEmailMd5=e.config.adminEmailMd5||"",e.math=e.config.math,e.md=e.config.md,e.visitor=e.config.visitor,e.tagMeta=e.config.tagMeta||[],e.master=e.config.master||[],e.friends=e.config.friends||[],e.mode=e.config.mode||"DesertsP",e.placeholder=e.config.placeholder||"",e.C=i.C,e.C.url=e.config.pathname||location.pathname,e.role=e.config.role?e.config.role:"admin",e.backend=e.config.backend?e.config.backend:"lc"}},292:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){var t=e.el.querySelector(".vmark");e.alert={show:function(n){t.innerHTML='<div class="valert txt-center"><div class="vtext">'.concat(n.text,'</div><div class="vbtns"></div></div>');var i=t.querySelector(".vbtns"),a='<button class="vcancel vbtn">'.concat(n.ctxt||e.i18n.cancel,"</button>"),r='<button class="vsure vbtn">'.concat(n.otxt||e.i18n.continue,"</button>");if(i.innerHTML="".concat(a).concat(n.type&&r),t.querySelector(".vcancel").addEventListener("click",(function(t){e.alert.hide()})),t.setAttribute("style","display:block;"),n.type){var l=t.querySelector(".vsure");o.default.on("click",l,(function(t){e.alert.hide(),n.cb&&n.cb()}))}},hide:function(){t.setAttribute("style","display:none;")}}}},1214:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){e.AtEvt=function(t){var n=t.getAttribute("id"),i=t.querySelector("#at-".concat(n));o.default.on("click",i,(function(a){var o=i.getAttribute("at"),r=i.getAttribute("rid");e.C.rid=r,e.C.at=o,e.el.querySelector(".vinputs-area  textarea").placeholder=o,e.inputs.comment.value="".concat(e.inputs.comment.value);var l=t.querySelector("#comment-".concat(n));try{l.appendChild(e.el.querySelector(".vinputs-wrap"))}catch(a){}e.el.querySelector(".vcancel-comment-reply").removeAttribute("style"),"DesertsP"===e.mode&&(e.el.querySelector(".commentTrigger").setAttribute("style","display:none"),e.el.querySelector(".auth-section").removeAttribute("style"),e.el.querySelector(".veditor").focus()),e.inputs.comment.focus()}))}}},6674:(e,t,n)=>{e.exports=function(e){window.MV.barrager={},window.MV.barrager.enable=1;var t=localStorage&&localStorage.getItem("MiniValineBarrager");t?(t=JSON.parse(t),window.MV.barrager.url=t.url):window.MV.barrager.url=[],function(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}(window.MV.barrager.url,document.location.href)||(window.MV.barrager.url.push(document.location.href),localStorage&&localStorage.setItem("MiniValineBarrager",JSON.stringify({url:window.MV.barrager.url})),n.e(83).then(n.bind(n,6664)).then((function(e){(0,e.barrager)()})))}},3288:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){o.default.on("click",e.el.querySelector(".cancel-reply-btn"),(function(t){e.reset()}))}},3756:(e,t,n)=>{var i=n(196);e.exports=function(e){var t=localStorage&&localStorage.getItem("MiniValineCache");if(t){t=JSON.parse(t);for(var n=["nick","link","mail"],a=0;a<n.length;a++){var o=n[a];e.el.querySelector(".v".concat(o)).value=t[o],e.C[o]=t[o]}if(""!==t.mail&&"DesertsP"===e.mode)e.el.querySelector(".visitor_avatar").setAttribute("data-src","".concat(i.GBUrl+md5(t.mail.toLowerCase().trim()),"?size=80&d=robohash"))}}},8447:(e,t,n)=>{var i,a=n(196),o=n(4460),r=(i=o)&&i.__esModule?i:{default:i};e.exports=function(e){if(window.MV.i18n)e.i18n=window.MV.i18n,window.MV.getI18n=0;else{var t=localStorage&&localStorage.getItem("MiniValineI18n");if(t&&(t=JSON.parse(t)).lang==e.lang?(e.i18n=t.i18n,window.MV.i18n=e.i18n,window.MV.getI18n=0):window.MV.getI18n=1,window.MV.getI18n){var n=e.lang.split("-");e.lang=n[0]+"-"+n[1].toUpperCase(),(0,r.default)({url:a.i18nUrl+e.lang+"/index.json",type:"GET",success:function(t){e.i18n=t,window.MV.i18n=e.i18n,localStorage&&localStorage.setItem("MiniValineI18n",JSON.stringify({lang:e.lang,i18n:e.i18n}))}})}}}},7375:(e,t,n)=>{var i=q(n(4291)),a=q(n(8447)),o=q(n(2285)),r=q(n(2716)),l=q(n(7574)),c=q(n(1401)),s=q(n(3604)),d=q(n(292)),u=q(n(3756)),f=q(n(2682)),v=q(n(4464)),m=q(n(673)),p=q(n(3288)),g=q(n(5320)),h=q(n(7866)),b=q(n(8183)),y=q(n(1214)),w=q(n(3952)),M=q(n(4425)),S=q(n(6346)),x=q(n(9010)),C=q(n(1480)),k=q(n(756)),A=q(n(7762)),E=q(n(6674));function q(e){return e&&e.__esModule?e:{default:e}}e.exports={Config:i.default,i18n:a.default,smile:o.default,script:r.default,initStyle:l.default,initLibs:c.default,uploadImage:s.default,alert:d.default,smileEvt:f.default,startEvt:v.default,resetForm:m.default,cancelReply:p.default,smileBtnEvt:g.default,previewBtnEvt:h.default,inputs:b.default,atEvt:y.default,submitBtnEvt:w.default,insertComment:M.default,nestQuery:S.default,parentQuery:x.default,ActivateCode:C.default,previewEvt:k.default,visitor:A.default,barrager:E.default,getCache:u.default}},1401:(e,t,n)=>{e.exports=function(e){var t=setInterval((function(){"undefined"!=typeof Promise&&(clearInterval(t),Promise.all([n.e(335),n.e(983),n.e(647)]).then(n.bind(n,8522)).then((function(t){(0,t.lib)(),"lc"==e.backend?Promise.all([n.e(501),n.e(714)]).then(n.bind(n,1509)).then((function(t){(0,t.lib)(),e.initCheck()})):e.initCheck()})))}),5)}},7574:(e,t,n)=>{e.exports=function(e){if(!e.config.closeCSS)var t=setInterval((function(){"undefined"!=typeof Promise&&(clearInterval(t),"DesertsP"===e.mode?Promise.all([n.e(335),n.e(526)]).then(n.bind(n,6893)):"xCss"===e.mode&&Promise.all([n.e(335),n.e(456)]).then(n.bind(n,6321)),(void 0===e.config.danmu||e.config.danmu)&&Promise.all([n.e(335),n.e(974)]).then(n.bind(n,6391)),e.config.dark&&Promise.all([n.e(335),n.e(487)]).then(n.bind(n,387)))}),5)}},8183:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){for(var t in e.inputs=Object.create(null),e.mapping={veditor:"comment",vnick:"nick",vlink:"link",vmail:"mail"},e.mapping)e.mapping.hasOwnProperty(t)&&function(){var n=e.mapping[t],i=e.el.querySelector(".".concat(t));e.inputs[n]=i,o.default.on("input",i,(function(t){e.C[n]=i.value,e.previewEvt(e)}))}()}},9270:e=>{e.exports=function(e,t){if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,i=e.selectionEnd,a=e.scrollTop;e.value=e.value.substring(0,n)+t+e.value.substring(i,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=a}else e.focus(),e.value+=t}},4425:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e,t){e.insertComment=function(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=document.createElement("li");r.setAttribute("class","vcard"),r.setAttribute("id",i.id),r.innerHTML=t.vcard(e,i),e.ActivateCode(e);for(var l=a||e.el.querySelector(".vlist"),c=l.querySelectorAll("li"),s=r.querySelectorAll("a"),d=0,u=s.length;d<u;d++){var f=s[d];f&&"at"!==f.getAttribute("class")&&(f.setAttribute("target","_blank"),f.setAttribute("rel","nofollow"))}if(o)l.insertBefore(r,c[0]);else try{l.appendChild(r)}catch(e){}var v=r.querySelector(".vcomment");return n(v),e.AtEvt(r),r};var n=function(e){e.offsetHeight>180&&(e.classList.add("expand"),o.default.on("click",e,(function(t){e.setAttribute("class","vcomment")})))}}},6346:(e,t,n)=>{var i=o(n(9493)),a=o(n(3195));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){e.nestQuery=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=t.querySelector(".vcomment-children"),r=o.querySelector(".vlist"),l=t.getAttribute("id");if(n<=0&&o.setAttribute("style","margin-left: 0 !important"),n>=e.maxNestLevel){var c=function(n){if(n>0){var a=o.querySelector(".vshow-children-wrapper");a.setAttribute("style","display: block !important;"),a.innerHTML='<span class="vshow-children" rid="'.concat(l,'">').concat(e.i18n.more,"</span>");var r=a.querySelector(".vshow-children");i.default.on("click",r,(function(n){a.setAttribute("style","display: none !important;"),e.nestQuery(t,-1e3)}))}};e.fetchNextCount(e,l,c)}else setTimeout((function(){e.fetchNextList(e,l,(function(t){var i=t.length;if(i)for(var o=function(i){if(!t[i].get("isSpam")){t[i].TEXT=t[i].get("comment"),(0,a.default)(t[i],(function(a){t[i].set("comment",a.TEXT);var o=e.insertComment(t[i],r,!0);e.nestQuery(o,n+1)}))}},l=0;l<i;l++)o(l)}))}),60*n)}}},9010:(e,t,n)=>{var i=o(n(9493)),a=o(n(3195));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){var t=1;e.TotalPages=0,e.parentQuery=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e.loading.show();var o=function(o){var r=o.length;if(r){for(var l=function(t){if(0==t&&e.loading.hide(e.TotalPages),o[t].get("isSpam"))return"continue";o[t].TEXT=o[t].get("comment"),(0,a.default)(o[t],(function(n){o[t].set("comment",n.TEXT);var i=e.insertComment(o[t],e.el.querySelector(".vlist"),!1);i.setAttribute("style","margin-bottom: .5em"),e.nestQuery(i)}))},c=0;c<r;c++)l(c);var s=e.el.querySelector(".vpage");s.innerHTML=n<e.TotalPages?'<div id="vmore" class="more">'.concat(e.i18n.more,"</div>"):"";var d=s.querySelector("#vmore");d&&i.default.on("click",d,(function(n){s.innerHTML="",e.parentQuery(++t)}))}try{void 0===window.MV.barrager.bottom||void 0!==e.config.barrager&&1!=e.config.barrager||(window.MV.barrager.enable=0)}catch(e){}e.loading.hide(e.TotalPages)};e.fetchParentList(e,n,o)};e.fetchTotalPages(e,(function(t){e.TotalPages=t,e.parentQuery(1)}))}},8301:(e,t,n)=>{var i,a=n(4460),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){try{(0,o.default)({url:"https://ip.zxinc.org/api.php",type:"GET",data:{type:"json"},success:function(t){window.MV.fuck=1,window.MV.region=t,e.C.ip=t.data.myip,window.MV.ip=e.C.ip}})}catch(e){}}},2243:(e,t,n)=>{var i,a=n(2162),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e,t,n){var i=e.C.comment.match(/!\(:(.*?\.\w+):\)/g);if(i)for(var a=0;a<i.length;a++){var r=i[a].match(/!\(:(.*?\.\w+):\)/)[1],l=e.emoticon[r],c=new RegExp("!\\(:"+r.replace(/\./,"\\.")+":\\)","g");"lc"==e.backend?e.C.comment=e.C.comment.replace(c,'<img src="'.concat(l,'" alt="').concat(r,'" class="vemoticon-img">')):"waline"==e.backend&&(e.C.comment=e.C.comment.replace(c,"![".concat(r,"](").concat(l,")")))}t.TEXT=e.C.comment,(0,o.default)(e,t,n)}},2162:(e,t,n)=>{var i,a=n(3195),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e,t,i){("waline"==e.backend&&t.preview||"lc"==e.backend)&&(e.md||void 0===e.config.md)?Promise.all([n.e(599),n.e(853),n.e(685)]).then(n.bind(n,8394)).then((function(e){var n=e.markdown;t.TEXT=n(t.TEXT),(0,o.default)(t,i)})):(0,o.default)(t,i)}},4460:e=>{var t=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")};e.exports=function(e){(e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json";var n=t(e.data),i=null;(i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4===i.readyState){var t=i.status;if(t>=200&&t<300){if(e.success)try{e.success&&e.success(JSON.parse(i.responseText),JSON.parse(i.responseXML))}catch(t){e.success(i.responseText,i.responseXML)}}else e.fail&&e.fail(t)}},"GET"==e.type?(i.open("GET",e.url+"?"+n,!0),i.send(null)):"POST"==e.type&&(i.open("POST",e.url,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(n))}},3755:e=>{e.exports={mail:function(e){return{k:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e),v:e}},link:function(e){return e.length>0&&(e=/^(http|https)/.test(e)?e:"http://".concat(e)),{k:!(e.length>0)||/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/.test(e),v:e}}}},9493:e=>{var t={on:function(e,n,i,a){for(var o=0,r=(e=e.split(" ")).length;o<r;o++)t.off(e[o],n,i,a),n.addEventListener?n.addEventListener(e[o],i,a||!1):n.attachEvent?n.attachEvent("on".concat(e[o]),i):n["on".concat(e[o])]=i},off:function(e,t,n,i){for(var a=0,o=(e=e.split(" ")).length;a<o;a++)t.removeEventListener?t.removeEventListener(e,n,i||!1):t.detachEvent?t.detachEvent("on".concat(e),n):t["on".concat(e)]=null}};e.exports=t},1983:e=>{e.exports=function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e;try{document.getElementsByTagName("head")[0].appendChild(t)}catch(e){}}},3195:(e,t,n)=>{e.exports=function(e,t){Promise.all([n.e(252),n.e(186)]).then(n.bind(n,2847)).then((function(n){var i=n.XSS;e.TEXT=i(e.TEXT),t(e)}))}},7866:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){var t=e.el.querySelector(".vpreview-btn"),n=e.el.querySelector(".vemoji-btn"),i=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".vsmile-icons");o.default.on("click",t,(function(o){if(a.getAttribute("triggered")&&(a.setAttribute("style","display:none;"),a.removeAttribute("triggered"),n.classList.remove("actived")),i.getAttribute("triggered"))i.setAttribute("style","display:none;"),i.removeAttribute("triggered"),t.classList.remove("actived");else{if(t.classList.add("actived"),""===e.C.comment)return void e.inputs.comment.focus();e.previewEvt(e)}}))}},756:(e,t,n)=>{var i,a=n(2243),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){e.previewEvt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.el.querySelector(".vpreview-btn"),i=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".veditor"),r=function(i){i.preview=!0,i.innerHTML=i.TEXT,i.removeAttribute("style"),i.setAttribute("triggered",1),n.classList.add("actived"),a.value?autosize(a):autosize.destroy(a),e.ActivateCode(e,t)};(0,o.default)(e,i,r)}}},673:(e,t,n)=>{var i,a=n(3756),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){var t=e.el.querySelector(".vsmile-icons"),n=e.el.querySelector(".vpreview-text");e.reset=function(){for(var i in e.mapping)if(e.mapping.hasOwnProperty(i)){var a=e.mapping[i];e.el.querySelector(".".concat(i)).value="",e.C[a]=""}e.C.rid="",e.C.nick="",e.C.at="",e.el.querySelector(".vinputs-area  textarea").placeholder="",(0,o.default)(e),e.previewEvt(e),t.getAttribute("triggered")&&(t.setAttribute("style","display:none;"),t.removeAttribute("triggered")),n.getAttribute("triggered")&&(n.setAttribute("style","display:none;"),n.removeAttribute("triggered")),e.el.querySelector(".vcancel-comment-reply").setAttribute("style","display:none");try{e.el.querySelector("#vinputs-placeholder").appendChild(e.el.querySelector(".vinputs-wrap"))}catch(e){}}}},2716:(e,t,n)=>{var i=n(196),a=r(n(1983)),o=r(n(8301));function r(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){"lc"!=e.backend||e.config.NoRecordIP||(void 0===window.MV.ip?(0,o.default)(e):e.C.ip=window.MV.ip),void 0===window.MV.pf&&((0,a.default)(i.pf),window.MV.pf=!0),(void 0===e.config.barrager||e.config.barrager)&&void 0===window.MV.jq&&("undefined"==typeof jQuery&&(0,a.default)("https://cdn.jsdelivr.net/npm/jquery"),window.MV.jq=!0),"lc"!=e.backend||void 0!==e.visitor&&!e.visitor||(0,a.default)("https://cdn.jsdelivr.net/npm/fingerprintjs2")}},2285:(e,t,n)=>{var i,a=n(4460),o=(i=a)&&i.__esModule?i:{default:i};var r=function(e,t){(0,o.default)({url:t+"/index.json",type:"GET",success:function(n){for(var i=[],a=0;a<n[0].length;a++)i.push(t+"/"+n[0][a]),e.emoticon[n[0][a]]=t+"/"+n[0][a];e.emoticonList.push(i)}})};e.exports=function(e){if(window.MV.emoticonUrl=e.emoticonUrl,!window.MV.emoticonList){var t=localStorage&&localStorage.getItem("MiniValineSmile");if(t)if(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}((t=JSON.parse(t)).emoticonUrl,e.emoticonUrl)){e.emoticonList=t.emoticonList,e.emoticon=[];for(var n=0;n<e.emoticonList.length;n++)for(var i=0;i<e.emoticonList[n].length;i++)e.emoticon[e.emoticonList[n][i].split("/")[e.emoticonList[n][i].split("/").length-1]]=e.emoticonList[n][i];window.MV.emoticonList=e.emoticonList,window.MV.emoticon=e.emoticon,window.MV.getSmile=0}else window.MV.getSmile=1;else window.MV.getSmile=1;if(window.MV.getSmile){e.emoticonList=[],e.emoticon=[];for(var a=0;a<e.emoticonUrl.length;a++)r(e,e.emoticonUrl[a]);window.MV.emoticonList=e.emoticonList,window.MV.emoticon=e.emoticon}else e.emoticonList=window.MV.emoticonList,e.emoticon=window.MV.emoticon;setTimeout((function(){localStorage&&localStorage.setItem("MiniValineSmile",JSON.stringify({emoticonUrl:window.MV.emoticonUrl,emoticonList:window.MV.emoticonList}))}),5e3)}}},5320:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){var t=e.el.querySelector(".vemoji-btn"),n=e.el.querySelector(".vpreview-btn"),i=e.el.querySelector(".vpreview-text"),a=e.el.querySelector(".vsmile-body");o.default.on("click",t,(function(e){i.getAttribute("triggered")&&(i.setAttribute("style","display:none;"),i.removeAttribute("triggered"),n.classList.remove("actived")),a.getAttribute("triggered")?(a.setAttribute("style","display:none;"),a.removeAttribute("triggered"),t.classList.remove("actived")):(a.removeAttribute("style"),a.setAttribute("triggered",1),t.classList.add("actived"))}))}},2682:(e,t,n)=>{var i=o(n(9493)),a=o(n(9270));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){var t=e.el.querySelector(".vsmile-icons");i.default.on("click",t,(function(t){var n=e.el.querySelector(".veditor"),i=t.target.src;if(void 0!==i){var o="!(:".concat(decodeURI(i).replace(/^.*\/(.*)$/,"$1"),":)");(0,a.default)(n,o),e.C.comment=n.value;var r=e.el.querySelector(".vsubmit");r.getAttribute("disabled")&&r.removeAttribute("disabled")}}))}},4464:(e,t,n)=>{var i,a=n(9493),o=(i=a)&&i.__esModule?i:{default:i};e.exports=function(e){var t=e.el.querySelector(".commentTrigger");o.default.on("click",t,(function(n){t.setAttribute("style","display:none"),e.el.querySelector(".auth-section").removeAttribute("style"),e.el.querySelector(".veditor").focus()}))}},3952:(e,t,n)=>{var i=r(n(9493)),a=r(n(2243)),o=r(n(3755));function r(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){var t=e.el.querySelector(".vsubmit");e.submitEvt=function(i){if(t.getAttribute("disabled"))e.alert.show({type:0,text:e.i18n.wait+'ヾ(๑╹◡╹)ﾉ"',ctxt:e.i18n.ok});else if(""!==e.C.comment)if(""!==e.C.nick){(0,a.default)(e,e,(function(e){if(e.C.comment=e.TEXT,"lc"==e.backend&&""!==e.C.at){var t='<a class="at" href=\'#'.concat(e.C.rid,"'>").concat(e.C.at,"</a>");e.C.comment=t+" , "+e.C.comment}var i=o.default.mail(e.C.mail),a=o.default.link(e.C.link);e.C.mail=i.k?i.v:"",e.C.link=a.k?a.v:"",e.C.mailMd5=md5(e.C.mail),i.k&&a.k?n():e.alert.show({type:0,text:e.i18n.inputTips,ctxt:e.i18n.confirm})}))}else e.inputs.nick.focus();else e.inputs.comment.focus()};var n=function(){t.setAttribute("disabled",!0),e.submitting.show();try{var n=e.C.ip;n&&(/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/.test(n)||/^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$/.test(n))&&"127.0.0.1"!=n||(window.MV.fuck=0,kill())}catch(e){}try{window.MV.MC&&window.MV.MC.util&&window.MV.MC.util.Visitor()}catch(e){}e.postComment(e,(function(n){localStorage&&localStorage.setItem("MiniValineCache",JSON.stringify({nick:e.C.nick,link:e.C.link,mail:e.C.mail}));var i=e.el.querySelector(".count");if(i.innerText=Number(i.innerText)+1,""===e.C.rid)e.insertComment(n,null,!0);else{var a=e.el.querySelector("#children-list-".concat(e.C.rid));e.insertComment(n,a,!0)}t.removeAttribute("disabled"),e.submitting.hide(),e.nodata.hide(),e.reset()}))};i.default.on("click",t,e.submitEvt)}},3604:(e,t,n)=>{var i=o(n(9493)),a=o(n(9270));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=function(e){var t=e.el.querySelector(".veditor");i.default.on("keydown",document,(function(n){var i=(n=event||n).keyCode||n.which||n.charCode;((n.ctrlKey||n.metaKey)&&13===i&&e.submitEvt(),9===i)&&("veditor"==(document.activeElement.className||"")&&(n.preventDefault(),(0,a.default)(t,"    ")))}));var n=function(n){if(n.length)for(var i=function(i){var r=n[i],l="![Uploading ".concat(r.name,"]()");(0,a.default)(t,l),o(r,(function(n,i){!n&&i&&(t.value=t.value.replace(l,"\r\n![".concat(r.name,"](").concat(i.data.url,")")),e.C.comment=t.value)}))},r=0;r<n.length;r++)i(r)};i.default.on("paste",document,(function(e){var t="clipboardData"in e?e.clipboardData:e.originalEvent&&e.originalEvent.clipboardData||window.clipboardData,i=t&&t.items,a=[];if(i&&i.length>0){for(var o=0;o<i.length;o++)if(-1!==i[o].type.indexOf("image")){a.push(i[o].getAsFile());break}n(a)}}));var o=function(e,t){var n=new FormData;n.append("image",e);var i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4===i.readyState&&200===i.status)try{var e=JSON.parse(i.responseText);t&&t(null,e)}catch(e){t&&t(e)}else t&&t(i.status)},i.onerror=function(e){console.log(e)},i.open("POST","https://pic.alexhchu.com/api/upload",!0),i.send(n)},r=document.getElementsByClassName("veditor")[0];r.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),r.addEventListener("dragenter",(function(e){e.preventDefault(),e.stopPropagation()})),r.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation();var t=this.files||e.dataTransfer.files;n(t)}))}},7762:(e,t,n)=>{e.exports=function(e){(void 0===e.visitor||e.visitor)&&n.e(707).then(n.bind(n,239)).then((function(t){(0,t.MCo)(e.config)}))}}},i={};function a(e){if(i[e])return i[e].exports;var t=i[e]={id:e,loaded:!1,exports:{}};return n[e].call(t.exports,t,t.exports,a),t.loaded=!0,t.exports}return a.m=n,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>"MiniValine."+{83:"barrager",92:"fetch-waline-counter",186:"xss",220:"fetch-lc-CloudFlag",252:"npm.xss",290:"body-xCss",335:"npm.style-loader",401:"fetch-lc-base",456:"style-xCss",487:"style-dark",501:"npm.leancloud-storage",526:"style-DesertsP",531:"md-style",599:"npm.highlight.js",600:"math",643:"fetch-lc-counter",647:"lib",685:"md",707:"visitor",714:"lib-av",840:"vcard-DesertsP",843:"vcard-barrager",853:"npm.marked",864:"fetch-waline-base",940:"body-DesertsP",974:"style-barrager",983:"npm.lazysizes",999:"ua"}[e]+".min.js",a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="MiniValine:",a.l=(n,i,o)=>{if(e[n])e[n].push(i);else{var r,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),s=0;s<c.length;s++){var d=c[s];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+o){r=d;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+o),r.src=n),e[n]=[i];var u=(t,i)=>{r.onerror=r.onload=null,clearTimeout(f);var a=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),a&&a.forEach((e=>e(i))),t)return t(i)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="https://cdn.jsdelivr.net/npm/minivaline@5.0.0-alpha.3/dist/",(()=>{var e={554:0};a.f.j=(t,n)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise(((n,a)=>{i=e[t]=[n,a]}));n.push(i[2]=o);var r=a.p+a.u(t),l=new Error;a.l(r,(n=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",l.name="ChunkLoadError",l.type=o,l.request=r,i[1](l)}}),"chunk-"+t)}};var t=self.webpackChunkMiniValine=self.webpackChunkMiniValine||[],n=t.push.bind(t);t.push=t=>{for(var i,o,[r,l,c]=t,s=0,d=[];s<r.length;s++)o=r[s],a.o(e,o)&&e[o]&&d.push(e[o][0]),e[o]=0;for(i in l)a.o(l,i)&&(a.m[i]=l[i]);for(c&&c(a),n(t);d.length;)d.shift()()}})(),a(9506)})()}));